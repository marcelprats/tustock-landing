---
import Hero from '~/components/widgets/Hero.astro';
import Features from '~/components/widgets/Features.astro';
import Features2 from '~/components/widgets/Features2.astro';
import Features3 from '~/components/widgets/Features3.astro';
import Steps from '~/components/widgets/Steps.astro';
import Content from '~/components/widgets/Content.astro';
import Testimonials from '~/components/widgets/Testimonials.astro';
import FAQs from '~/components/widgets/FAQs.astro';
import CallToAction from '~/components/widgets/CallToAction.astro';
import PricingSection from '~/components/widgets/PricingSection.astro'; 
import Stats from '~/components/widgets/Stats.astro';
import Brands from '~/components/widgets/Brands.astro';

// Importamos la config del menú lateral para que coincidan los IDs
import { landingSections } from '~/navigation';

// Recibimos los datos reales desde index.astro
const { shopCount = "10+", userCount = "50+" } = Astro.props;
---

<div class="relative overflow-hidden">
  
  <aside class="hidden xl:block fixed left-6 top-1/2 -translate-y-1/2 z-40">
    <nav class="flex flex-col gap-3 p-3 bg-white/60 dark:bg-slate-900/60 backdrop-blur-xl rounded-full shadow-2xl border border-white/20 dark:border-slate-700/30 transition-all duration-300" id="landing-menu">
      {landingSections.map(({ text, target }) => (
        <a 
          href={`#${target}`} 
          class="group flex items-center gap-3 p-2 transition-all nav-link rounded-full hover:bg-white/50 dark:hover:bg-slate-800/50"
          data-target={target}
          aria-label={text}
        >
          <div class="w-2.5 h-2.5 rounded-full bg-slate-400/50 group-hover:bg-blue-600 group-[.active]:bg-blue-500 group-[.active]:shadow-[0_0_10px_rgba(59,130,246,0.6)] transition-all"></div>
          <span class="absolute left-14 bg-slate-900 text-white text-[10px] font-bold uppercase tracking-widest px-2 py-1 rounded opacity-0 -translate-x-2 group-hover:opacity-100 group-hover:translate-x-0 transition-all pointer-events-none whitespace-nowrap z-50 shadow-xl">
            {text}
          </span>
        </a>
      ))}
    </nav>
  </aside>

  <div class="flex-1 w-full">
    
    <div id="hero">
      <Hero
        actions={[
          {
            variant: 'primary',
            text: 'Prueba Gratis (14 días)',
            href: '/register',
            icon: 'tabler:rocket',
            class: 'shadow-xl shadow-blue-500/20 hover:shadow-blue-500/40 hover:-translate-y-1 transition-all duration-300'
          },
          { text: 'Ver Demo Fiscal', href: '#fiscalidad' },
        ]}
        image={{ src: '~/assets/images/hero-image.png', alt: 'TuStock Dashboard' }}
      >
        <fragment slot="title">
          Gestión de Stock con IA y <br class="hidden md:inline" />
          <span class="text-accent dark:text-white highlight">Cumplimiento Fiscal 2026</span>
        </fragment>

        <fragment slot="subtitle">
          <span class="font-light text-lg">
            La única plataforma que combina <b>Inteligencia Artificial predictiva</b> para tu inventario con la generación automática de <b>Factura Electrónica (Ley Crea y Crece)</b>.
            <br/>
            Ingeniería de datos para tu tienda. Seguridad legal para tu negocio.
          </span>
        </fragment>
      </Hero>
    </div>

    <div class="border-y border-gray-100 dark:border-slate-800 bg-blue-50/30 dark:bg-slate-900/30 backdrop-blur-sm">
      <Stats
        stats={[
          { title: 'Tiendas Activas', amount: `${shopCount}` },
          { title: 'Usuarios', amount: `${userCount}` },
          { title: 'VeriFactu', amount: 'Ready' },
          { title: 'Privacidad', amount: '100%' },
        ]}
      />
    </div>

    <div id="features" class="scroll-mt-20">
      <Features3
        title="Todo tu negocio. Un solo sistema operativo."
        subtitle="Sustituye a tu Gestoría (parcialmente), a tu ERP antiguo y a tus Excels."
        tagline="Funcionalidades Core"
        columns={3}
        isBeforeContent={true}
        items={[
          {
            title: 'Inventario IA',
            description: 'Predice roturas de stock antes de que pasen. "¿Cuánto pedir de X?" La IA te responde.',
            icon: 'tabler:brain',
          },
          {
            title: 'Factura Electrónica',
            description: 'Generación automática de XML firmados para Hacienda. Cumple la Ley Crea y Crece sin tocar nada.',
            icon: 'tabler:gavel',
          },
          {
            title: 'Escáner de Albaranes',
            description: 'Sube una foto del albarán de tu proveedor. La IA extrae los productos y actualiza el stock sola.',
            icon: 'tabler:scan',
          },
          {
            title: 'TPV Cloud & Local',
            description: 'Vende desde el iPad o el PC. Si se cae internet, sigue funcionando gracias a nuestra base de datos local.',
            icon: 'tabler:device-desktop',
          },
          {
            title: 'CRM Clientes',
            description: 'Analiza quién compra qué. Segmenta a tus mejores clientes y ofréceles descuentos automáticos.',
            icon: 'tabler:users-group',
          },
          {
            title: 'Privacidad On-Device',
            description: 'Tus datos sensibles nunca salen de tu ordenador si usas la App de Escritorio. Cifrado militar.',
            icon: 'tabler:lock-square',
          },
        ]}
      />
    </div>

    <div id="fiscalidad" class="scroll-mt-20 bg-slate-50 dark:bg-slate-800/20 py-10">
      <Content
        isReversed
        tagline="Ley Crea y Crece & VeriFactu"
        title="No dejes que Hacienda te quite el sueño"
        items={[
          {
            title: 'Preparado para 2026',
            description: 'España obligará a todas las empresas B2B a emitir factura electrónica. TuStock ya genera el formato estructurado legal.',
          },
          {
            title: 'Trazabilidad Total',
            description: 'Cada movimiento de stock queda registrado. Si tienes una inspección, generas el reporte de trazabilidad en un clic.',
          },
          {
            title: 'Cierre de Caja Automático',
            description: 'Olvídate de contar monedas hasta las 10 de la noche. El arqueo de caja se hace solo y se envía a tu gestor.',
          },
        ]}
        image={{
          src: 'https://images.unsplash.com/photo-1554224155-6726b3ff858f?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80',
          alt: 'Legal Compliance',
        }}
      >
        <fragment slot="content">
          <h3 class="text-2xl font-bold tracking-tight dark:text-white sm:text-3xl mb-2">Seguridad Jurídica</h3>
        </fragment>
      </Content>
    </div>

    <div id="ai-core" class="scroll-mt-20">
      <Content
        tagline="Automatización"
        title="Tu empleado digital que no duerme"
        items={[
          {
            title: 'Lectura de Documentos',
            description: 'Arrastra un PDF o foto de una factura de compra. Nuestra IA (OCR avanzado) lee las líneas y mete el stock.',
          },
          {
            title: 'Chat con tus Datos',
            description: 'Pregunta en lenguaje natural: "¿Qué productos tienen margen negativo?" o "¿Qué día de la semana vendo más?".',
          },
        ]}
        image={{
          src: 'https://images.unsplash.com/photo-1633419461186-7d40a2e50594?ixlib=rb-4.0.3&auto=format&fit=crop&w=2069&q=80',
          alt: 'AI Analysis',
        }}
      >
        <fragment slot="content">
          <h3 class="text-2xl font-bold tracking-tight dark:text-white sm:text-3xl mb-2">IA Generativa Real</h3>
        </fragment>
      </Content>
    </div>

    <div id="steps" class="scroll-mt-20">
      <Steps
        title="Migra tu negocio en una tarde"
        items={[
          {
            title: 'Paso 1: <span class="font-medium">Importación</span>',
            description: 'Sube tu Excel de productos actual o conecta tu WooCommerce/Shopify.',
            icon: 'tabler:file-spreadsheet',
          },
          {
            title: 'Paso 2: <span class="font-medium">Configuración Fiscal</span>',
            description: 'Mete tus datos de empresa. Nosotros configuramos los impuestos automáticamente según tu región.',
            icon: 'tabler:settings',
          },
          {
            title: 'Paso 3: <span class="font-medium">Vende y Olvida</span>',
            description: 'Empieza a usar el TPV. El stock y la contabilidad se actualizan solos en tiempo real.',
            icon: 'tabler:device-ipad',
          },
        ]}
        image={{
          src: 'https://images.unsplash.com/photo-1519389950473-47ba0277781c?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80',
          alt: 'Steps image',
        }}
      />
    </div>

    <div id="pricing" class="scroll-mt-20">
      <PricingSection
        title="Inversión transparente"
        subtitle="Más barato que una multa de Hacienda. Más barato que tu tiempo perdido."
        prices={[
          {
            title: 'Starter',
            subtitle: 'Para empezar a digitalizar',
            price: '0',
            period: '/mes',
            items: [
              { description: 'Hasta 100 productos' },
              { description: 'TPV Web Básico' },
              { description: 'Facturas Simplificadas' },
              { description: 'Sin IA Avanzada' },
            ],
            callToAction: {
              target: '_self',
              text: 'Crear Gratis',
              href: '/register',
            },
          },
          {
            title: 'Pro',
            subtitle: 'El estándar del Retail',
            price: 29,
            period: '/mes',
            items: [
              { description: 'Productos Ilimitados' },
              { description: 'Factura Electrónica (B2B)' },
              { description: 'IA Predictiva de Stock' },
              { description: 'Escáner de Albaranes' },
              { description: 'Soporte Prioritario' },
            ],
            callToAction: {
              target: '_self',
              text: 'Prueba 14 días',
              href: '/register?plan=pro',
            },
            hasRibbon: true,
            ribbonTitle: 'Recomendado',
          },
          {
            title: 'Enterprise',
            subtitle: 'Franquicias y Cadenas',
            price: '99',
            period: '/mes',
            items: [
              { description: 'Multi-tienda unificada' },
              { description: 'API Rest Completa' },
              { description: 'Servidor Dedicado' },
              { description: 'Gestor de Cuenta' },
              { description: 'Auditoría Fiscal' },
            ],
            callToAction: {
              target: '_self',
              text: 'Contactar',
              href: '/contact',
            },
          },
        ]}
      />
    </div>

    <div id="faq" class="scroll-mt-20">
      <FAQs
        title="Preguntas Frecuentes"
        subtitle="Respondemos a lo que de verdad importa."
        items={[
          {
            title: '¿Cumple con la Ley Antifraude 11/2021?',
            description: 'Sí. El software garantiza la integridad, conservación, accesibilidad, legibilidad, trazabilidad e inalterabilidad de los registros.',
          },
          {
            title: '¿Necesito instalar algo en mi ordenador?',
            description: 'No. TuStock funciona en la nube. Sin embargo, ofrecemos una App de Escritorio opcional si quieres que la IA funcione más rápido y sin internet.',
          },
          {
            title: '¿Mis datos son míos?',
            description: 'Absolutamente. Puedes exportar todo tu catálogo, clientes y facturas a Excel/CSV o JSON en cualquier momento con un clic.',
          },
          {
            title: '¿Puedo conectar mi tienda online?',
            description: 'Sí, tenemos integraciones nativas con WooCommerce, Shopify y PrestaShop para unificar el stock físico y online.',
          },
        ]}
      />
    </div>

    <Brands
      title="Tecnología de base"
      subtitle="Construido sobre infraestructura de clase mundial."
      icons={[]}
      images={[
        { src: 'https://cdn.pixabay.com/photo/2013/02/12/09/07/microsoft-80658_1280.png', alt: 'Azure Cloud' },
        { src: 'https://upload.wikimedia.org/wikipedia/commons/thumb/4/44/Stripe_Logo%2C_revised_2016.svg/2560px-Stripe_Logo%2C_revised_2016.svg.png', alt: 'Stripe Payments' },
        { src: 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/e1/Google_Chrome_icon_%28February_2022%29.svg/800px-Google_Chrome_icon_%28February_2022%29.svg.png', alt: 'PWA Ready' },
      ]}
    />

    <CallToAction
      actions={[
        {
          variant: 'primary',
          text: 'Digitalizar mi negocio ahora',
          href: '/register',
          target: '_self',
          icon: 'tabler:check',
        },
      ]}
    >
      <fragment slot="title">
        ¿Listo para tomar el control?
      </fragment>

      <fragment slot="subtitle">
        Deja de trabajar para tu tienda y haz que tu tienda trabaje para ti.<br/>
        Sin permanencia. Sin tarjeta para empezar.
      </fragment>
    </CallToAction>

  </div>
</div>

<script>
  const observerOptions = {
    root: null,
    rootMargin: '-20% 0px -60% 0px',
    threshold: 0
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const id = entry.target.getAttribute('id');
        
        // Reset
        document.querySelectorAll('.nav-link').forEach(link => {
          link.classList.remove('active'); 
        });
        
        // Activar
        const activeLink = document.querySelector(`.nav-link[data-target="${id}"]`);
        if (activeLink) {
          activeLink.classList.add('active');
        }
      }
    });
  }, observerOptions);

  // Observar todas las secciones clave
  document.querySelectorAll('#hero, #features, #fiscalidad, #ai-core, #steps, #pricing, #faq').forEach((section) => {
    observer.observe(section);
  });
</script>