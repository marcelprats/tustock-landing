---
import Hero from '~/components/widgets/Hero.astro';
import Features from '~/components/widgets/Features.astro';
import Steps from '~/components/widgets/Steps.astro';
import Content from '~/components/widgets/Content.astro';
import Testimonials from '~/components/widgets/Testimonials.astro';
import FAQs from '~/components/widgets/FAQs.astro';
import CallToAction from '~/components/widgets/CallToAction.astro';
import PricingSection from '~/components/widgets/PricingSection.astro'; // Asegúrate de tener este componente o usa Content

import { landingSections } from '~/navigation';
---

<div class="relative max-w-7xl mx-auto px-4 sm:px-6 flex gap-8">
  
  <aside class="hidden lg:block w-48 shrink-0 sticky top-24 h-fit py-8 self-start">
    <nav class="flex flex-col gap-1 border-l-2 border-gray-200 dark:border-gray-800 pl-4" id="landing-menu">
      {landingSections.map(({ text, target }) => (
        <a 
          href={`#${target}`} 
          class="text-sm font-medium text-gray-500 hover:text-blue-600 dark:text-gray-400 dark:hover:text-blue-400 transition-colors py-1 block nav-link border-l-2 border-transparent -ml-[18px] pl-4"
          data-target={target}
        >
          {text}
        </a>
      ))}
    </nav>
  </aside>

  <div class="flex-1 min-w-0 pb-20">
    
    <div id="hero" class="scroll-mt-24">
      <Hero 
        tagline="TuStock SaaS"
        title="Gestiona tu negocio con Inteligencia Artificial"
        subtitle="Todo lo que necesitas para vender, controlar stock y facturar en una sola plataforma."
        actions={[{ text: 'Empezar Gratis', href: '/register', icon: 'tabler:rocket' }]}
        image={{ src: '~/assets/images/hero-image.png', alt: 'TuStock Hero' }}
      />
    </div>

    <div id="features" class="scroll-mt-24">
      <Features
        title="Todo lo que necesitas"
        subtitle="Herramientas potentes simplificadas para ti."
        items={[
          { title: 'Inventario IA', description: 'Predicción de stock inteligente.', icon: 'tabler:box' },
          { title: 'Facturación', description: 'Genera facturas en un click.', icon: 'tabler:file-invoice' },
          { title: 'TPV Web', description: 'Vende desde cualquier lugar.', icon: 'tabler:device-laptop' },
        ]}
      />
    </div>

    <div id="benefits" class="scroll-mt-24">
      <Steps
        title="Puesta en marcha en 3 pasos"
        items={[
          { title: 'Regístrate', description: 'Crea tu cuenta en 30 segundos.' },
          { title: 'Sube tus productos', description: 'O impórtalos desde Excel.' },
          { title: 'Empieza a vender', description: 'Tu tienda lista al instante.' },
        ]}
        image={{
            src: 'https://images.unsplash.com/photo-1616198814651-e71f960c3180?ixlib=rb-4.0.3&auto=format&fit=crop&w=987&q=80',
            alt: 'Steps image',
        }}
      />
    </div>

    <div id="testimonials" class="scroll-mt-24">
      <Testimonials
        title="Lo que dicen nuestros clientes"
        testimonials={[
          { testimonial: 'Ha cambiado mi forma de trabajar.', name: 'Paco', job: 'Frutería Paco' },
        ]}
      />
    </div>

    <div id="pricing" class="scroll-mt-24">
       <Content title="Planes Flexibles" subtitle="Elige el que mejor se adapte a ti" /> 
    </div>

    <div id="faq" class="scroll-mt-24">
      <FAQs
        title="Preguntas Frecuentes"
        items={[
          { title: '¿Es gratis?', description: 'Sí, tenemos un plan gratuito para siempre.' },
        ]}
      />
    </div>

    <CallToAction
      title="¿Listo para empezar?"
      actions={[{ text: 'Crear Cuenta', href: '/register', icon: 'tabler:user-plus' }]}
    />

  </div>
</div>

<script>
  // Configuración del observador
  const observerOptions = {
    root: null,
    rootMargin: '-20% 0px -60% 0px', // Ajusta la zona activa de detección
    threshold: 0
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const id = entry.target.getAttribute('id');
        
        // 1. Desactivar todos
        document.querySelectorAll('.nav-link').forEach(link => {
          link.classList.remove('text-blue-600', 'font-bold', 'border-blue-600', 'dark:text-blue-400');
          link.classList.add('text-gray-500', 'border-transparent');
        });
        
        // 2. Activar el actual
        const activeLink = document.querySelector(`.nav-link[data-target="${id}"]`);
        if (activeLink) {
          activeLink.classList.remove('text-gray-500', 'border-transparent');
          activeLink.classList.add('text-blue-600', 'font-bold', 'border-blue-600', 'dark:text-blue-400'); 
        }
      }
    });
  }, observerOptions);

  // Observar todas las secciones definidas en navigation.ts
  const sectionIds = ['hero', 'features', 'benefits', 'testimonials', 'pricing', 'faq'];
  sectionIds.forEach((id) => {
    const section = document.getElementById(id);
    if (section) observer.observe(section);
  });
</script>