---
import Layout from '~/layouts/PageLayout.astro';
import MainHome from '~/components/landing/MainHome.astro';

// 1. Estadísticas dinámicas desde D1
let shopCount = "10+";
let userCount = "50+";

const db = Astro.locals.runtime?.env?.DB;

if (db) {
  try {
    const shops = await db.prepare("SELECT COUNT(*) as total FROM tenants").first();
    const users = await db.prepare("SELECT COUNT(*) as total FROM users").first();
    
    if (shops?.total) shopCount = shops.total.toString();
    if (users?.total) userCount = users.total.toString();
  } catch (e) {
    console.error("Error al cargar estadísticas en Index:", e);
  }
}

const metadata = { 
  title: 'TuStock - Gestión de Inventario Híbrida con IA',
  ignoreTitleTemplate: true 
};
---

<Layout metadata={metadata}>
  <MainHome shopCount={shopCount} userCount={userCount} />
</Layout>