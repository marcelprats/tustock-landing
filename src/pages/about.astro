---
import Layout from '~/layouts/PageLayout.astro';
import HeroText from '~/components/widgets/HeroText.astro';
import Content from '~/components/widgets/Content.astro';
import Steps2 from '~/components/widgets/Steps2.astro';
import Stats from '~/components/widgets/Stats.astro';
import Features3 from '~/components/widgets/Features3.astro';

//  1. CONEXIN A BBDD REAL (D1)
// Sacamos los datos reales. Nada de mentiras.
const db = Astro.locals.runtime?.env?.DB;
let shopCount = 0;
let userCount = 0;

if (db) {
  try {
    // Contamos tiendas creadas
    const shops = await db.prepare("SELECT COUNT(*) as total FROM tenants").first();
    // Contamos usuarios registrados
    const users = await db.prepare("SELECT COUNT(*) as total FROM users").first();
    
    shopCount = shops.total || 0;
    userCount = users.total || 0;
  } catch (e) {
    console.error("Error obteniendo stats:", e);
  }
}

const metadata = {
  title: 'Sobre Nosotros - C贸digo y Finanzas',
};
---

<Layout metadata={metadata}>
  
  <HeroText
    tagline="Nuestra Historia"
    title="Cuando las Finanzas conocen a la Ingenier铆a"
  >
    <fragment slot="subtitle">
      No somos una gran corporaci贸n. Somos <span class="font-bold text-blue-600 dark:text-blue-400">un Inform谩tico y un Contable</span> que se cansaron de ver c贸mo los peque帽os negocios perd铆an dinero por falta de herramientas.
    </fragment>
  </HeroText>

  <Stats
    title="Transparencia Radical"
    subtitle="Acabamos de empezar, pero vamos muy en serio. Estos son nuestros n煤meros reales en tiempo real:"
    stats={[
      { title: 'Tiendas Activas', amount: `${shopCount}` },
      { title: 'Usuarios', amount: `${userCount}` },
      { title: 'Lanzamiento', amount: '2025' },
      { title: 'Compromiso', amount: '100%' },
    ]}
  />

  <Content
    isReversed
    title="La Fusi贸n Perfecta"
    items={[
      {
        title: 'El Cerebro Financiero',
        description: 'A帽os viendo balances que no cuadran y stock perdido. La visi贸n contable asegura que TuStock no solo gestione productos, sino que vigile la rentabilidad de tu negocio al c茅ntimo.',
      },
      {
        title: 'El Cerebro Tecnol贸gico',
        description: 'Obsesionado con la eficiencia y la seguridad. La visi贸n t茅cnica asegura que el software vuele, no falle nunca y que tus datos est茅n blindados.',
      },
    ]}
    image={{
      src: 'https://images.unsplash.com/photo-1552581234-26160f608093?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80',
      alt: 'Meeting Tech Finance',
    }}
  >
    <fragment slot="content">
      <h3 class="text-2xl font-bold tracking-tight dark:text-white sm:text-3xl mb-2">驴Por qu茅 TuStock?</h3>
      <p>
        Porque vimos un hueco enorme. O usabas un Excel propenso a errores, o pagabas una fortuna por un ERP complejo.
        <br /><br />
        Decidimos juntar nuestros dos mundos: <b>El rigor de la contabilidad financiera con la potencia de la Inteligencia Artificial moderna.</b>
      </p>
    </fragment>

    <fragment slot="bg">
      <div class="absolute inset-0 bg-blue-50 dark:bg-transparent"></div>
    </fragment>
  </Content>

  <Features3
    title="Nuestros principios"
    subtitle="Lo que nos define como fundadores."
    columns={3}
    items={[
      {
        title: 'Verdad ante todo',
        description: 'No vendemos humo. Si el software tiene un fallo, te lo decimos y lo arreglamos. Sin letras peque帽as.',
        icon: 'tabler:bulb',
      },
      {
        title: 'Dato mata relato',
        description: 'Tus decisiones de negocio deben basarse en n煤meros reales, no en intuiciones. Por eso la IA analiza tus datos.',
        icon: 'tabler:chart-dots',
      },
      {
        title: 'Cercan铆a',
        description: 'Al ser fundadores t茅cnicos y financieros, entendemos tus problemas reales. Hablas con expertos, no con teleoperadores.',
        icon: 'tabler:users',
      },
    ]}
  />

  <Steps2
    title="Nuestro camino"
    subtitle="Sin atajos."
    items={[
      {
        title: 'Enero 2025: El inicio',
        description: 'Lanzamos la primera versi贸n p煤blica. Dos personas, dos port谩tiles y una misi贸n clara: salvar el retail.',
      },
      {
        title: 'Actualidad',
        description: 'Trabajando codo con codo con los primeros clientes (Early Adopters) para pulir el producto perfecto.',
      },
      {
        title: 'Futuro Pr贸ximo',
        description: 'Integraci贸n total de IA Local para predecir tus ventas antes de que ocurran.',
      },
    ]}
  />

</Layout>