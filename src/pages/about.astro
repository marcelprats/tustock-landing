---
import Layout from '~/layouts/PageLayout.astro';
import HeroText from '~/components/widgets/HeroText.astro';
import Content from '~/components/widgets/Content.astro';
import Steps2 from '~/components/widgets/Steps2.astro';
import Stats from '~/components/widgets/Stats.astro';
import Features3 from '~/components/widgets/Features3.astro';

// 游댠 1. CONEXI칍N A BBDD REAL (D1)
const db = Astro.locals.runtime?.env?.DB;
let shopCount = 0;
let userCount = 0;

if (db) {
  try {
    const shops = await db.prepare("SELECT COUNT(*) as total FROM tenants").first();
    const users = await db.prepare("SELECT COUNT(*) as total FROM users").first();
    shopCount = shops.total || 0;
    userCount = users.total || 0;
  } catch (e) {
    console.error("Error obteniendo stats:", e);
  }
}

const metadata = {
  title: 'Sobre Nosotros - C칩digo y Finanzas',
};
---

<Layout metadata={metadata}>
  
  <HeroText
    tagline="Nuestra Historia"
    title="Donde la Fiscalidad se une con la Inteligencia Artificial"
  >
    <fragment slot="subtitle">
      No somos una gran corporaci칩n. Somos <span class="font-bold text-blue-600 dark:text-blue-400">un Equipo T칠cnico y Financiero</span> que se cans칩 de ver c칩mo los peque침os negocios perd칤an dinero por el caos administrativo y la falta de tecnolog칤a.
    </fragment>
  </HeroText>

  <Stats
    title="Transparencia Radical"
    subtitle="N칰meros reales en tiempo real desde nuestra base de datos:"
    stats={[
      { title: 'Tiendas Activas', amount: `${shopCount}` },
      { title: 'Usuarios', amount: `${userCount}` },
      { title: 'Sede', amount: 'Barcelona' },
      { title: 'Compromiso', amount: '100%' },
    ]}
  />

  <Content
    isReversed
    title="La Fusi칩n Perfecta"
    items={[
      {
        title: 'El Cerebro Financiero',
        description: 'Experiencia real en auditor칤a y gesti칩n fiscal. Conocemos el dolor de la Factura Electr칩nica que viene y el caos de los albaranes perdidos. TuStock nace para que Hacienda no sea un problema.',
      },
      {
        title: 'El Cerebro Tecnol칩gico',
        description: 'Obsesi칩n por la automatizaci칩n. 쯇or qu칠 picar datos a mano si una IA puede leer una foto de un albar치n? Creamos tecnolog칤a que te devuelve horas de vida.',
      },
    ]}
    image={{
      src: 'https://images.unsplash.com/photo-1554224155-8d04cb21cd6c?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80',
      alt: 'Meeting Tech Finance',
    }}
  >
    <fragment slot="content">
      <h3 class="text-2xl font-bold tracking-tight dark:text-white sm:text-3xl mb-2">쯇or qu칠 TuStock?</h3>
      <p>
        Vimos un hueco enorme. O usabas un Excel propenso a errores, o pagabas una fortuna por un ERP complejo que nadie sabe usar.
        <br /><br />
        Decidimos juntar nuestros dos mundos: <b>El rigor de la ley fiscal espa침ola con la potencia de la Inteligencia Artificial generativa.</b>
      </p>
    </fragment>

    <fragment slot="bg">
      <div class="absolute inset-0 bg-blue-50 dark:bg-transparent"></div>
    </fragment>
  </Content>

  <Features3
    title="M치s que un simple inventario"
    subtitle="Construimos pensando en los problemas de hoy y las leyes de ma침ana."
    columns={3}
    items={[
      {
        title: 'Cumplimiento Legal 2026',
        description: 'Espa침a obligar치 a usar Factura Electr칩nica B2B. TuStock ya est치 preparado para generar y firmar digitalmente tus facturas sin que tengas que hacer nada.',
        icon: 'tabler:gavel',
      },
      {
        title: 'IA de Stock (Ya disponible)',
        description: 'Nuestro bot actual ya te permite consultar tu stock en lenguaje natural. "쮺u치ntas manzanas quedan?" y te responde al instante.',
        icon: 'tabler:robot',
      },
      {
        title: 'Digitalizaci칩n de Albaranes',
        description: 'Olv칤date de picar datos. A futuro, sacar치s una foto al albar치n de tu proveedor y TuStock actualizar치 el inventario solo.',
        icon: 'tabler:scan',
      },
    ]}
  />

  <Steps2
    title="Nuestro camino"
    subtitle="Sin atajos, construyendo valor real."
    items={[
      {
        title: '2025: Nace el proyecto',
        description: 'Unimos fuerzas para crear el MVP. Lanzamos la versi칩n web para ayudar a los primeros comercios a digitalizarse.',
      },
      {
        title: 'Actualidad: Desarrollo Web & App',
        description: 'Estamos perfeccionando la plataforma con feedback real. Implementando el motor de IA local y puliendo la experiencia de usuario.',
      },
      {
        title: 'Futuro: Ecosistema Total',
        description: 'IA Predictiva de compras, subida autom치tica de facturas a Hacienda (VeriFactu) y App nativa con esc치ner de albaranes.',
      },
    ]}
  />

</Layout>