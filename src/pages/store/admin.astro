---
import StoreAdminLayout from '~/layouts/StoreAdminLayout.astro'; // <--- USAMOS EL NUEVO
import AppDashboard from '~/components/app/AppDashboard.astro'; // Tu componente de gráficas

const { currentShop } = Astro.locals;
const session = Astro.cookies.get('session');

// Validación de sesión básica (el resto lo hace el layout)
if (!session) {
  return Astro.redirect(`/login?return_to=${encodeURIComponent(Astro.request.url)}`);
}

const metadata = { title: `Admin - ${currentShop?.name}` };
---

{/* Pasamos el tenant slug al layout para que haga sus queries */}
<StoreAdminLayout tenant={currentShop.slug} metadata={metadata}>
  
  {/* Aquí va el contenido central del Dashboard */}
  <div class="grid grid-cols-1 gap-6">
      
      {/* Puedes meter aquí tu AppDashboard simplificado si quieres reutilizar sus widgets */}
      {/* Ojo: AppDashboard ya no debería tener Layout dentro, solo divs */}
      <AppDashboard tenantId={currentShop.slug} />

  </div>

</StoreAdminLayout>